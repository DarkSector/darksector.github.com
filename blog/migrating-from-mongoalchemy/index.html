
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Migrating from MongoAlchemy - Pronoy Chopra's Blog</title>
  <meta name="author" content="Pronoy Chopra">

  
  <meta name="description" content="Extensions like Flask-MongoAlchemy and Flask-MongoKit are probably the most useless extensions for Flask because they ignore the inherent reason why &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://DarkSector.github.com/blog/migrating-from-mongoalchemy/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/ender.js"></script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <link href="/atom.xml" rel="alternate" title="Pronoy Chopra's Blog" type="application/atom+xml">
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="http://fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Pronoy Chopra's Blog</a></h1>
  
    <h2>Rants and code</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="http://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:DarkSector.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Migrating From MongoAlchemy</h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-05-02T22:59:00+05:30" pubdate data-updated="true">May 2<span>nd</span>, 2012</time>
        
      </p>
    
  </header>


<div class="entry-content"><p>Extensions like <a href="http://packages.python.org/Flask-MongoAlchemy/">Flask-MongoAlchemy</a> and <a href="http://flask.pocoo.org/docs/patterns/mongokit/">Flask-MongoKit</a> are probably the most useless extensions for <a href="http://flask.pocoo.org/">Flask</a> because they ignore the inherent reason why Mongo is to be used. What is the point of using <a href="http://www.mongodb.org/">MongoDB</a> when you are going to used a fix schema. A fixed model declaration should be used with RDBMS like PostGRE and SQLite by using <a href="http://www.sqlalchemy.org/">SQLAlchemy</a>.</p>

<p>I wonder why hasn&#8217;t anyone come up with this question before. Either way I&#8217;ll be using PyMongo now. Flask has an extension for that, it&#8217;s called <a href="http://flask-pymongo.readthedocs.org/en/0-1/index.html">Flask-PyMongo</a>.</p>

<h2>MongoDB Basics</h2>

<p>Here&#8217;re some interesting relations between SQL and MongoDB&#8217;s way of organizing things.</p>

<table class="table table-bordered table-striped">
    <thead>
        <tr>
            <th>SQL</th>
            <th>MongoDB</th>
        </tr>   
    </thead>
    <tbody> 
        <tr>
            <td>Database</td>
            <td>Database</td>
        </tr>
        <tr>
            <td>Table</td>
            <td>Collection</td>
        </tr>
        <tr>
            <td>Row</td>
            <td>Document</td>
        </tr>
        <tr>
            <td>Index</td>
            <td>Index</td>
        </tr>
        <tr>
            <td>Primary key</td>
            <td>_id field</td>
        </tr>
    </tbody>
</table>


<p>A complete list of relations is given in the mapping chart over at <a href="http://www.mongodb.org/display/DOCS/SQL+to+Mongo+Mapping+Chart">MongoDB&#8217;s website</a></p>

<p>This is neat considering you don&#8217;t need any fixed schema, just stash the data in and you can easily recover it. So now instead of using MongoAlchemy we will be using PyMongo directly which is fairly easy as well.</p>

<h2>Why Mongo with Python makes sense</h2>

<p>Python Dicts and Mongo&#8217;s BSON documents are just the same. So passing dicts as documents is fairly intuitive. Here&#8217;s a comparison:</p>

<figure class='code'><figcaption><span>dict.py</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="o">&gt;&gt;&gt;</span> <span class="n">a</span> <span class="o">=</span> <span class="p">{</span><span class="s">&quot;a&quot;</span> <span class="p">:</span> <span class="s">&quot;b&quot;</span><span class="p">,</span> <span class="s">&quot;c&quot;</span> <span class="p">:</span> <span class="s">&quot;d&quot;</span><span class="p">,</span> <span class="s">&quot;k&quot;</span> <span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span>MongoDB schema example</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='javascript'><span class='line'><span class="p">{</span>
</span><span class='line'>  <span class="nx">_id</span> <span class="o">:</span> <span class="nx">ObjectId</span><span class="p">(</span><span class="s2">&quot;4e77bb3b8a3e000000004f7a&quot;</span><span class="p">),</span>
</span><span class='line'>  <span class="nx">when</span> <span class="o">:</span> <span class="nb">Date</span><span class="p">(</span><span class="s2">&quot;2011-09-19T02:10:11.3Z&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">author</span> <span class="o">:</span> <span class="s2">&quot;alex&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">title</span> <span class="o">:</span> <span class="s2">&quot;No Free Lunch&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">text</span> <span class="o">:</span> <span class="s2">&quot;This is the text of the post.  It could be very long.&quot;</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">tags</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;business&quot;</span><span class="p">,</span> <span class="s2">&quot;ramblings&quot;</span> <span class="p">],</span>
</span><span class='line'>  <span class="nx">votes</span> <span class="o">:</span> <span class="mi">5</span><span class="p">,</span>
</span><span class='line'>  <span class="nx">voters</span> <span class="o">:</span> <span class="p">[</span> <span class="s2">&quot;jane&quot;</span><span class="p">,</span> <span class="s2">&quot;joe&quot;</span><span class="p">,</span> <span class="s2">&quot;spencer&quot;</span><span class="p">,</span> <span class="s2">&quot;phyllis&quot;</span><span class="p">,</span> <span class="s2">&quot;li&quot;</span> <span class="p">],</span>
</span><span class='line'>  <span class="nx">comments</span> <span class="o">:</span> <span class="p">[</span>
</span><span class='line'>    <span class="p">{</span> <span class="nx">who</span> <span class="o">:</span> <span class="s2">&quot;jane&quot;</span><span class="p">,</span> <span class="nx">when</span> <span class="o">:</span> <span class="nb">Date</span><span class="p">(</span><span class="s2">&quot;2011-09-19T04:00:10.112Z&quot;</span><span class="p">),</span>
</span><span class='line'>      <span class="nx">comment</span> <span class="o">:</span> <span class="s2">&quot;I agree.&quot;</span> <span class="p">},</span>
</span><span class='line'>    <span class="p">{</span> <span class="nx">who</span> <span class="o">:</span> <span class="s2">&quot;meghan&quot;</span><span class="p">,</span> <span class="nx">when</span> <span class="o">:</span> <span class="nb">Date</span><span class="p">(</span><span class="s2">&quot;2011-09-20T14:36:06.958Z&quot;</span><span class="p">),</span>
</span><span class='line'>      <span class="nx">comment</span> <span class="o">:</span> <span class="s2">&quot;You must be joking.  etc etc ...&quot;</span> <span class="p">}</span>
</span><span class='line'>  <span class="p">]</span>
</span><span class='line'><span class="p">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>It&#8217;s similar and therefore easier.</p>

<h2>PyMongo Usage</h2>

<figure class='code'><figcaption><span>start the mongo daemon on any port and application directory to store database</span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mongod --port 45000 --dbpath <span class="nv">$PATHTOAPPLICATIONDIRECTORY</span>
</span></code></pre></td></tr></table></div></figure>




<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class='python'><span class='line'><span class="c">#import pymongo and make the connection</span>
</span><span class='line'><span class="kn">from</span> <span class="nn">pymongo</span> <span class="kn">import</span> <span class="n">Connection</span>
</span><span class='line'><span class="c">#connect it to the mongo daemon running on the port</span>
</span><span class='line'><span class="n">connection</span> <span class="o">=</span> <span class="n">Connection</span><span class="p">(</span><span class="s">&#39;localhost&#39;</span><span class="p">,</span> <span class="mi">45000</span><span class="p">)</span>
</span></code></pre></td></tr></table></div></figure>


<p>After that we&#8217;ll need to start creating databases and collections and inserting documents, I&#8217;ll post the code later when I am done with general implementation.</p>
</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Pronoy Chopra</span></span>

      








  


<time datetime="2012-05-02T22:59:00+05:30" pubdate data-updated="true">May 2<span>nd</span>, 2012</time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/flask/'>Flask</a>, <a class='category' href='/blog/categories/flask-mongoalchemy/'>Flask-MongoAlchemy</a>, <a class='category' href='/blog/categories/mongodb/'>MongoDB</a>, <a class='category' href='/blog/categories/pymongo/'>PyMongo</a>, <a class='category' href='/blog/categories/python/'>Python</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="http://twitter.com/share" class="twitter-share-button" data-url="http://DarkSector.github.com/blog/migrating-from-mongoalchemy/" data-via="" data-counturl="http://DarkSector.github.com/blog/migrating-from-mongoalchemy/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/a-random-graph-using-d3-dot-js/" title="Previous Post: A random graph using d3.js">&laquo; A random graph using d3.js</a>
      
      
        <a class="basic-alignment right" href="/blog/single-trigger-terminal-hack-mac-os-x-lion/" title="Next Post: Single Trigger Terminal Hack Mac OS X Lion">Single Trigger Terminal Hack Mac OS X Lion &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/finally-got-allegro-5-working-on-mac-os-x/">Finally got Allegro 5 working on Mac OS X</a>
      </li>
    
      <li class="post">
        <a href="/blog/arduino-ir-code-updated/">Arduino IR code: updated</a>
      </li>
    
      <li class="post">
        <a href="/blog/nasas-iss-live-stream/">NASAs ISS live stream</a>
      </li>
    
      <li class="post">
        <a href="/blog/configured-linksys-wrt120n-bye-bye-old-wifi/">Configured Linksys WRT120N: Bye bye old Wifi</a>
      </li>
    
      <li class="post">
        <a href="/blog/heroku-is-full-of-surprises/">Heroku is full of surprises</a>
      </li>
    
  </ul>
</section>

<section>
  <h1>GitHub Repos</h1>
  <ul id="gh_repos">
    <li class="loading">Status updating...</li>
  </ul>
  
  <a href="https://github.com/DarkSector">@DarkSector</a> on GitHub
  
  <script type="text/javascript">
    $.domReady(function(){
        if (!window.jXHR){
            var jxhr = document.createElement('script');
            jxhr.type = 'text/javascript';
            jxhr.src = '/javascripts/libs/jXHR.js';
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(jxhr, s);
        }

        github.showRepos({
            user: 'DarkSector',
            count: 0,
            skip_forks: true,
            target: '#gh_repos'
        });
    });
  </script>
  <script src="/javascripts/github.js" type="text/javascript"> </script>
</section>






  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2012 - Pronoy Chopra -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = 'http://platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
